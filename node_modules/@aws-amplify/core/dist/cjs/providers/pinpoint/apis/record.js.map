{"version":3,"file":"record.js","sources":["../../../../../src/providers/pinpoint/apis/record.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.record = void 0;\nconst amplifyUuid_1 = require(\"../../../utils/amplifyUuid\");\nconst utils_1 = require(\"../utils\");\nconst sessionListener_1 = require(\"../../../utils/sessionListener\");\nconst constants_1 = require(\"../utils/constants\");\nconst getEventBuffer_1 = require(\"../utils/getEventBuffer\");\nlet session;\n/**\n * @internal\n */\nconst record = async ({ appId, category, channelType, credentials, event, identityId, region, userAgentValue, bufferSize, flushInterval, flushSize, resendLimit, }) => {\n    let eventSession = session;\n    const currentTime = new Date();\n    const timestampISOString = currentTime.toISOString();\n    const eventId = (0, amplifyUuid_1.amplifyUuid)();\n    // Prepare event buffer if required\n    const buffer = (0, getEventBuffer_1.getEventBuffer)({\n        appId,\n        region,\n        credentials,\n        bufferSize: bufferSize ?? constants_1.BUFFER_SIZE,\n        flushInterval: flushInterval ?? constants_1.FLUSH_INTERVAL,\n        flushSize: flushSize ?? constants_1.FLUSH_SIZE,\n        resendLimit: resendLimit ?? constants_1.RESEND_LIMIT,\n        identityId,\n        userAgentValue,\n    });\n    const endpointId = await (0, utils_1.resolveEndpointId)({\n        appId,\n        category,\n        channelType,\n        credentials,\n        identityId,\n        region,\n        userAgentValue,\n    });\n    // Generate session if required\n    if (!eventSession || event.name === sessionListener_1.SESSION_START_EVENT) {\n        const sessionId = (0, amplifyUuid_1.amplifyUuid)();\n        session = {\n            Id: sessionId,\n            StartTimestamp: timestampISOString,\n        };\n        eventSession = session;\n    }\n    // Terminate session when required\n    if (session && event.name === sessionListener_1.SESSION_STOP_EVENT) {\n        eventSession = {\n            ...session,\n            StopTimestamp: timestampISOString,\n            Duration: currentTime.getTime() - new Date(session.StartTimestamp).getTime(),\n        };\n        session = undefined;\n    }\n    // Push event to buffer\n    buffer.push({\n        eventId,\n        endpointId,\n        event,\n        session: eventSession,\n        timestamp: timestampISOString,\n        resendLimit: resendLimit ?? constants_1.RESEND_LIMIT,\n    });\n};\nexports.record = record;\n"],"names":[],"mappings":"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"}